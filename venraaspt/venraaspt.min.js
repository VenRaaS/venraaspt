var venstrob={v:"1.6.3",strserver:"apid.venraas.tw",struuidapi:"/venapis/vengu",strlogapi:"/venapis/log",stract:"action",strcrt:"create",stradd:"add",strrec:"add_rec",stradi:"add_item",strsnd:"send",strall:"all",strwarn:"[warning] venraas ",strnull:"ven_null",strdn:"x",strtoken:"x",strtypeInit:"0",strtypeTracking:"1",strtypeEctrans:"2",strtypeGuid:"3",strtypeSession:"4",strtypeRecomd:"5",venfloctl_processing:"",strDhermesHost:"apih.venraas.tw",strDHermesApi:"/hermes/api/goods/rank",strCupidHost:"apir.venraas.tw",
strCupidKeywordApi:"/cupid/api/goods/keywords"},venfloctl={},venraastool={getcookie:function(a){theCookie=document.cookie+";";a+="=";start=theCookie.indexOf(a);return-1!=start?(end=theCookie.indexOf(";",start),theCookie.substring(start+a.length,end)):""},doCookieSetup:function(a,b,c){try{if(0==c)document.cookie=a+"="+escape(b)+";Path=/;domain="+window.location.host.split(".").slice(-3).join(".");else{var e=new Date;e.setTime(e.getTime()+c);document.cookie=a+"="+escape(b)+";expires="+e.toGMTString()+
";Path=/;domain="+window.location.host.split(".").slice(-3).join(".")}}catch(d){}},dect_type:function(a,b){if("string"!=typeof a||"object"!=typeof b)return!1},object_size:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},urlparamfactory:function(a,b){var c=[];if("object"!=typeof b)return"";if(a==venstrob.strnull)for(var e in b)c.push(encodeURIComponent(e)+"="+encodeURIComponent(JSON.stringify(b[e])));else c.push(encodeURIComponent(a)+"="+encodeURIComponent(JSON.stringify(b[a])));
return c.join("&")},xhr:!window.XMLHttpRequest||"file:"===window.location.protocol&&window.ActiveXObject?function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}:function(){return new window.XMLHttpRequest},getvenuuid:function(a,b){try{var c="?id="+top.location.host+"&typ="+a+"&pt=a";if(window.XDomainRequest&&(0<navigator.userAgent.indexOf("MSIE 8.0")||0<navigator.userAgent.indexOf("MSIE 9.0")))venstrob.venfloctl_processing=b,venraastool.ven_jsonp("https://"+venstrob.strserver+
venstrob.struuidapi+c+"&cbk=y");else if(0<navigator.userAgent.indexOf("MSIE 7.0")||0<navigator.userAgent.indexOf("MSIE 6.0"))venstrob.venfloctl_processing=b,venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.struuidapi+c+"&cbk=y");else{var e=venraastool.xhr();e.open("GET","https://"+venstrob.strserver+venstrob.struuidapi+c,!0);e.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");e.withCredentials=!0;e.onreadystatechange=function(){try{4==e.readyState&&200==
e.status&&(vencontrob.vencookiecontr(a,e.responseText),"s"==a?vencontrob.actioncontroller(b):venfloctl[b].status=!0)}catch(d){}};e.send()}}catch(d){}},isarray:function(a){return!!a&&"object"===typeof a&&"number"===typeof a.length&&"function"===typeof a.splice&&!a.propertyIsEnumerable("length")},ven_jsonp:function(a){try{var b=document.createElement("script");b.setAttribute("src",a);document.body.appendChild(b)}catch(c){}},hashCode:function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++){var e=
a.charCodeAt(c);b=(b<<5)-b+e;b|=0}return b},updateCachekeys:function(a,b){var c="venraas-token"+a+" cache keys",e=(new Date).getTime(),d={key:b,expires_timestamp:e+6048E5},f=localStorage.getItem(c),g=[d];if(f){g=JSON.parse(f);var h=!1;g.forEach(function(a,c,e){a.key===b&&(e[c]=d,h=!0)});h||g.push(d);g.forEach(function(a,b,c){a.expires_timestamp<=e&&localStorage.removeItem(a.key)});g=g.filter(function(a){return e<a.expires_timestamp})}localStorage.setItem(c,JSON.stringify(g))},getrecomd:function(a){var b=
venfloctl[a].objv.param;b.ven_guid=venraastool.getcookie("venguid");b.ven_session=venraastool.getcookie("vensession");var c=venfloctl[a].objv.callback,e=JSON.stringify({device:b.device,rec_pos:b.rec_pos,rec_type:b.rec_type,token:b.token}),d=venraastool.xhr();d.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){c(this.responseText,b);var d=JSON.parse(this.responseText);d.recomd_list&&0<d.recomd_list.length&&(localStorage.setItem(e,this.responseText),venraastool.updateCachekeys(b.token,
e));venfloctl[a].status=!0}}catch(h){console.log(h.message)}};d.timeout=2E3;d.ontimeout=function(a){(a=localStorage.getItem(e))?console.log("venraas recomd timeout! response the last result"):(a={},console.log("venraas recomd timeout! none of the last result"));c(a,b)};d.open("POST","https://"+venstrob.strDhermesHost+venstrob.strDHermesApi,!0);d.setRequestHeader("Content-type","application/json; charset=UTF-8");d.withCredentials=!0;var f=JSON.stringify(b);d.send(f)},saveLocalStorage:function(a,b){try{var c=
JSON.stringify({device:a.device,rec_pos:a.rec_pos,rec_type:a.rec_type,token:a.token}),e=JSON.parse(b);e.recomd_list&&0<e.recomd_list.length&&(localStorage.setItem(c,b),venraastool.updateCachekeys(a.token,c))}catch(d){console.log(d.message)}},getLocalStorage:function(a){try{var b=JSON.stringify({device:a.device,rec_pos:a.rec_pos,rec_type:a.rec_type,token:a.token});return localStorage.getItem(b)}catch(c){console.log(c.message)}},recomd:function(a,b){var c=venraastool.getcookie("venguid");if(""==c){var e=
"https://"+venstrob.strserver+venstrob.struuidapi+"?id="+top.location.host+"&typ=g&pt=a",d=venraastool.xhr();d.open("GET",e,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");d.withCredentials=!0;d.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){venraastool.doCookieSetup("venguid",this.responseText,31536E7);c=this.responseText;var e="https://"+venstrob.strserver+venstrob.struuidapi+"?id="+top.location.host+"&typ=s&pt=a",d=venraastool.xhr();
d.open("GET",e,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");d.withCredentials=!0;d.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){venraastool.doCookieSetup("vensession",this.responseText,18E5);f=this.responseText;var d="https://"+venstrob.strDhermesHost+venstrob.strDHermesApi;a.ven_guid=c;a.ven_session=f;var e=venraastool.xhr();e.open("POST",d,!0);e.setRequestHeader("Content-type","application/json; charset=UTF-8");e.withCredentials=
!0;e.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&(venraastool.saveLocalStorage(a,this.responseText),b(this.responseText,a))}catch(m){console.log(m.message)}};e.timeout=2E3;e.ontimeout=function(c){(c=venraastool.getLocalStorage(a))?console.log("venraas recomd timeout! response the last result"):(c={},console.log("venraas recomd timeout! none of the last result"));b(c,a)};var g=JSON.stringify(a);e.send(g)}}catch(m){}};d.send()}}catch(k){}};d.send()}else{var f=venraastool.getcookie("vensession");
""==f?(e="https://"+venstrob.strserver+venstrob.struuidapi+"?id="+top.location.host+"&typ=s&pt=a",d=venraastool.xhr(),d.open("GET",e,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8"),d.withCredentials=!0,d.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){venraastool.doCookieSetup("vensession",this.responseText,18E5);f=this.responseText;var e="https://"+venstrob.strDhermesHost+venstrob.strDHermesApi;a.ven_guid=c;a.ven_session=f;var d=
venraastool.xhr();d.open("POST",e,!0);d.setRequestHeader("Content-type","application/json; charset=UTF-8");d.withCredentials=!0;d.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&(venraastool.saveLocalStorage(a,this.responseText),b(this.responseText,a))}catch(l){console.log(l.message)}};d.timeout=2E3;d.ontimeout=function(c){(c=venraastool.getLocalStorage(a))?console.log("venraas recomd timeout! response the last result"):(c={},console.log("venraas recomd timeout! none of the last result"));
b(c,a)};var k=JSON.stringify(a);d.send(k)}}catch(l){}},d.send()):(d="https://"+venstrob.strDhermesHost+venstrob.strDHermesApi,a.ven_guid=c,a.ven_session=f,e=venraastool.xhr(),e.open("POST",d,!0),e.setRequestHeader("Content-type","application/json; charset=UTF-8"),e.withCredentials=!0,e.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&(venraastool.saveLocalStorage(a,this.responseText),b(this.responseText,a))}catch(g){console.log(g.message)}},e.timeout=2E3,e.ontimeout=function(c){lastRespText?
console.log("venraas recomd timeout! response the last result"):(lastRespText={},console.log("venraas recomd timeout! none of the last result"));b(lastRespText,a)},d=JSON.stringify(a),e.send(d))}},goods_keywords:function(a,b){var c=venraastool.xhr();c.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&b(this.responseText)}catch(d){console.log(d.message)}};c.open("POST","https://"+venstrob.strCupidHost+venstrob.strCupidKeywordApi,!0);c.setRequestHeader("Content-type","application/json; charset=UTF-8");
c.withCredentials=!0;var e=JSON.stringify(a);c.send(e)},get_paramValFromURL:function(a,b){var c=b.split("?",2);if(2==c.length){c=c[1].split("&");for(var e=0;e<c.length;++e){var d=c[e].split("=",2);if(2==d.length&&a==d[0])return decodeURIComponent(d[1].replace(/\+/g," "))}}return null}},vencontrob={createcontr:function(a,b){this.creadata(a);this.setpdata(a,venstrob.stract,a);this.addcontr(a,b)},addcontr:function(a,b){for(var c in b)this.setpdata(a,c,b[c])},addrecitemcontr:function(a,b){venraastool.isarray(this.pdata[a].now_rec)||
(this.pdata[a].now_rec=[]);this.pdata[a].now_rec[this.pdata[a].now_rec.length]=b},addtritemcontr:function(a,b){venraastool.isarray(this.pdata[a].trans_i.ilist)||(this.pdata[a].trans_i.ilist=[]);this.pdata[a].trans_i.ilist[this.pdata[a].trans_i.ilist.length]=b},sendcontr:function(a){a==venstrob.strall?this.apirequest(venstrob.strnull):this.apirequest(a)},autoretrieve:function(a){this.setpdata(a,"para",location.search);this.setpdata(a,"uri",location.pathname);this.setpdata(a,"client_host",venstrob.strdn);
this.setpdata(a,"token",venstrob.strtoken);this.setpdata(a,"tophost",top.location.host);this.setpdata(a,"referrer",document.referrer);try{this.setpdata(a,"client_tzo",(new Date).getTimezoneOffset()),this.setpdata(a,"client_utc",(new Date).getTime())}catch(c){}this.setpdata(a,"ven_guid",venraastool.getcookie("venguid"));this.setpdata(a,"ven_session",venraastool.getcookie("vensession"));this.setpdata(a,"ver",venstrob.v);var b=this.getpdata(a,"from_rec");b&&"null"!=b||(b=venraastool.get_paramValFromURL("from_rec",
location.href))&&this.setpdata(a,"from_rec",b)},pdata:{},creadata:function(a){this.pdata[a]={}},getpdata:function(a,b){return this.pdata[a]?this.pdata[a][b]:void 0},setpdata:function(a,b,c){"undefined"==typeof this.pdata[a]&&(this.pdata[a]={});this.pdata[a][b]=c},delpdata:function(a){a==venstrob.strnull?this.pdata={}:this.pdata[a]={}},apirequest:function(a){a=venraastool.urlparamfactory(a,this.pdata);if(""!==a)try{if(window.XDomainRequest&&(0<navigator.userAgent.indexOf("MSIE 8.0")||0<navigator.userAgent.indexOf("MSIE 9.0")))venraastool.ven_jsonp("https://"+
venstrob.strserver+venstrob.strlogapi+"?"+a);else if(0<navigator.userAgent.indexOf("MSIE 7.0")||0<navigator.userAgent.indexOf("MSIE 6.0"))venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.strlogapi+"?"+a);else{var b=venraastool.xhr();b.open("POST","https://"+venstrob.strserver+venstrob.strlogapi,!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");b.withCredentials=!0;b.onreadystatechange=function(){};b.send(a)}}catch(c){}},actioncontroller:function(a){var b=
venfloctl[a].venact,c=venfloctl[a].objv;switch(venfloctl[a].contr){case venstrob.strcrt:var e=!0;0==c.autosend&&(e=!1);vencontrob.createcontr(b,c);vencontrob.autoretrieve(b);1==e&&vencontrob.sendcontr(b);break;case venstrob.stradd:vencontrob.addcontr(b,c);break;case venstrob.strsnd:vencontrob.sendcontr(b);break;case venstrob.strrec:vencontrob.addrecitemcontr(b,c)}venfloctl[a].status=!0},vencookiecontr:function(a,b){"g"==a?venraastool.doCookieSetup("venguid",b,31536E7):"s"==a&&venraastool.doCookieSetup("vensession",
b,18E5)}};function vengujsonpcallbk(a,b){try{vencontrob.vencookiecontr(a,b),"s"==a?vencontrob.actioncontroller(venstrob.venfloctl_processing):venfloctl[venstrob.venfloctl_processing].status=!0}catch(c){}}
var venraas={init:function(a){try{"undefined"!==typeof a&&"undefined"!==typeof a.domainName&&(venstrob.strdn=a.domainName);"undefined"!==typeof a&&"undefined"!==typeof a.token&&(venstrob.strtoken=a.token);if(null===document.getElementById("venraasfr")){var b=document.createElement("iframe");b.setAttribute("id","venraasfr");b.style.display="none";b.style.width="1px";b.style.height="1px";b.style.border="0px";b.style.padding="0px";b.style.margin="0px";b.src="https://"+venstrob.strserver+venstrob.struuidapi;
"undefined"==typeof a||"undefined"==typeof a.tagID?document.body.appendChild(b):null!==document.getElementById(a.tagID)?document.getElementById(a.tagID).appendChild(b):console.log("[Error] venraas document.getElementById("+a.tagID+") is not exist!")}if(""==venraastool.getcookie("venguid")&&"undefined"!==typeof venfloctl){var c=venraastool.object_size(venfloctl);venfloctl[c]={};venfloctl[c].status=!1;venfloctl[c].contr="";venfloctl[c].venact="";venfloctl[c].objv="";venfloctl[c].type=venstrob.strtypeGuid;
venfloctl[c].retry=0;this.ven_cps(c)}}catch(e){}},tracking:function(a,b){try{if("undefined"==typeof b&&(b={}),0!=venraastool.dect_type(a,b)){var c="",e="";-1<a.indexOf("|")?(cmdar=a.split("|"),c=cmdar[0],e=cmdar[1]):(c=venstrob.strall,e=a);if("undefined"!==typeof venfloctl){var d=venraastool.object_size(venfloctl);venfloctl[d]={};venfloctl[d].status=!1;venfloctl[d].contr=e;venfloctl[d].venact=c;venfloctl[d].objv=b;venfloctl[d].type=venstrob.strtypeTracking;venfloctl[d].retry=0;this.ven_cps(d)}}}catch(f){}},
ven_tracking:function(a){""==venraastool.getcookie("vensession")?venraastool.getvenuuid("s",a):(venraastool.doCookieSetup("vensession",venraastool.getcookie("vensession"),18E5),vencontrob.actioncontroller(a))},ven_cps:function(a){try{if(0==a||venfloctl[a-1].status)switch(venfloctl[a].type){case venstrob.strtypeTracking:venraas.ven_tracking(a);break;case venstrob.strtypeEctrans:venraas.ven_ecTransaction(a);break;case venstrob.strtypeGuid:venraastool.getvenuuid("g",a);break;case venstrob.strtypeSession:venraastool.getvenuuid("s",
a);break;case venstrob.strtypeRecomd:venraastool.getrecomd(a)}else 3>venfloctl[a].retry&&(venfloctl[a].retry++,setTimeout("venraas.ven_cps("+a+")",100))}catch(b){}},ecTransaction:function(a,b){try{if("undefined"==typeof b&&(b={}),0!=venraastool.dect_type(a,b)){var c="",e="";-1<a.indexOf("|")&&(cmdar=a.split("|"),c=cmdar[0],e=cmdar[1]);if("undefined"!==typeof venfloctl){var d=venraastool.object_size(venfloctl);venfloctl[d]={};venfloctl[d].status=!1;venfloctl[d].contr=e;venfloctl[d].venact=c;venfloctl[d].objv=
b;venfloctl[d].type=venstrob.strtypeEctrans;venfloctl[d].retry=0;this.ven_cps(d)}}}catch(f){}},ven_ecTransaction:function(a){var b=venfloctl[a].objv,c=venfloctl[a].venact;switch(venfloctl[a].contr){case venstrob.stradd:b.ilist={};var e={};e.trans_i=b;vencontrob.addcontr(c,e);break;case venstrob.stradi:vencontrob.addtritemcontr(c,b);break;default:console.log(venstrob.strwarn+":input exception. c3")}venfloctl[a].status=!0}};