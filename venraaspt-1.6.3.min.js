var venstrob={v:"1.6.3",strserver:"apid.venraas.tw",struuidapi:"/venapis/vengu",strlogapi:"/venapis/log",stract:"action",strcrt:"create",stradd:"add",strrec:"add_rec",stradi:"add_item",strsnd:"send",strall:"all",strwarn:"[warning] venraas ",strnull:"ven_null",strdn:"x",strtoken:"x",strtypeInit:"0",strtypeTracking:"1",strtypeEctrans:"2",strtypeGuid:"3",strtypeSession:"4",strtypeRecomd:"5",venfloctl_processing:"",strDhermesHost:"apih.venraas.tw",strDHermesApi:"/hermes/api/goods/rank",strCupidHost:"apir.venraas.tw",strCupidKeywordApi:"/cupid/api/goods/keywords"},venfloctl=new Object,venraastool={getcookie:function(t){return theCookie=document.cookie+";",t+="=",start=theCookie.indexOf(t),-1!=start?(end=theCookie.indexOf(";",start),theCookie.substring(start+t.length,end)):""},doCookieSetup:function(t,e,o){try{if(0==o)document.cookie=t+"="+escape(e)+";Path=/;domain="+window.location.host.split(".").slice(-3).join(".");else{var n=new Date;n.setTime(n.getTime()+o),document.cookie=t+"="+escape(e)+";expires="+n.toGMTString()+";Path=/;domain="+window.location.host.split(".").slice(-3).join(".")}}catch(t){}},dect_type:function(t,e){return"string"==typeof t&&("object"==typeof e&&void 0)},object_size:function(t){var e=0;for(var o in t)t.hasOwnProperty(o)&&e++;return e},urlparamfactory:function(t,e){var o=[];if("object"!=typeof e)return"";if(t==venstrob.strnull)for(var n in e)o.push(encodeURIComponent(n)+"="+encodeURIComponent(JSON.stringify(e[n])));else o.push(encodeURIComponent(t)+"="+encodeURIComponent(JSON.stringify(e[t])));return o.join("&")},xhr:!window.XMLHttpRequest||"file:"===window.location.protocol&&window.ActiveXObject?function(){try{return console.log('debug in xhr=window.ActiveXObject("Microsoft.XMLHTTP")'),new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}:function(){return console.log("debug in xhr=window.XMLHttpRequest()"),new window.XMLHttpRequest},getvenuuid:function(t,e){try{var o="?id="+top.location.host+"&typ="+t+"&pt=a";if(window.XDomainRequest&&(navigator.userAgent.indexOf("MSIE 8.0")>0||navigator.userAgent.indexOf("MSIE 9.0")>0))venstrob.venfloctl_processing=e,venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.struuidapi+o+"&cbk=y");else if(navigator.userAgent.indexOf("MSIE 7.0")>0||navigator.userAgent.indexOf("MSIE 6.0")>0)venstrob.venfloctl_processing=e,venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.struuidapi+o+"&cbk=y");else{var n;(n=venraastool.xhr()).open("GET","https://"+venstrob.strserver+venstrob.struuidapi+o,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8"),n.withCredentials=!0,n.onreadystatechange=function(){try{4==n.readyState&&200==n.status&&(vencontrob.vencookiecontr(t,n.responseText),"s"==t?vencontrob.actioncontroller(e):venfloctl[e].status=!0)}catch(t){}},n.send()}}catch(t){}},isarray:function(t){return!!t&&"object"==typeof t&&"number"==typeof t.length&&"function"==typeof t.splice&&!t.propertyIsEnumerable("length")},ven_jsonp:function(t){try{var e=document.createElement("script");e.setAttribute("src",t),document.body.appendChild(e)}catch(t){}},hashCode:function(t){var e=0;if(0===t.length)return e;for(var o=0;o<t.length;o++){e=(e<<5)-e+t.charCodeAt(o),e|=0}return e},updateCachekeys:function(t,e){var o="venraas-token"+t+" cache keys",n=(new Date).getTime(),s={key:e,expires_timestamp:n+6048e5},r=localStorage.getItem(o),a=[s];if(r){a=JSON.parse(r);var i=!1;a.forEach(function(t,o,n){t.key===e&&(n[o]=s,i=!0)}),i||a.push(s),a.forEach(function(t,e,o){t.expires_timestamp<=n&&localStorage.removeItem(t.key)});var c=a.filter(function(t){return n<t.expires_timestamp});a=c}localStorage.setItem(o,JSON.stringify(a))},getrecomd:function(t){var e=venfloctl[t].objv.param;e.ven_guid=venraastool.getcookie("venguid"),e.ven_session=venraastool.getcookie("vensession");var o=venfloctl[t].objv.callback,n={device:e.device,rec_pos:e.rec_pos,rec_type:e.rec_type,token:e.token},s=JSON.stringify(n),r=venraastool.xhr();r.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){o(this.responseText,e);var n=JSON.parse(this.responseText);n.recomd_list&&0<n.recomd_list.length&&(localStorage.setItem(s,this.responseText),venraastool.updateCachekeys(e.token,s)),venfloctl[t].status=!0}}catch(t){console.log(t.message)}},r.timeout=2e3,r.ontimeout=function(t){var n=localStorage.getItem(s);n?console.log("venraas recomd timeout! response the last result"):(n={},console.log("venraas recomd timeout! none of the last result")),o(n,e)},r.open("POST","https://"+venstrob.strDhermesHost+venstrob.strDHermesApi,!0),r.setRequestHeader("Content-type","application/json; charset=UTF-8"),r.withCredentials=!0;var a=JSON.stringify(e);r.send(a)},saveLocalStorage:function(t,e){try{var o={device:t.device,rec_pos:t.rec_pos,rec_type:t.rec_type,token:t.token},n=JSON.stringify(o),s=JSON.parse(e);s.recomd_list&&0<s.recomd_list.length&&(localStorage.setItem(n,e),venraastool.updateCachekeys(t.token,n))}catch(t){console.log(t.message)}},getLocalStorage:function(t){try{var e={device:t.device,rec_pos:t.rec_pos,rec_type:t.rec_type,token:t.token},o=JSON.stringify(e);return localStorage.getItem(o)}catch(t){console.log(t.message)}},recomd:function(t,e){var o=venraastool.getcookie("venguid");if(""==o){console.log("debug in venguid is not exist");var n="https://"+venstrob.strserver+venstrob.struuidapi+"?id="+top.location.host+"&typ=g&pt=a",s=venraastool.xhr();return s.open("GET",n,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8"),s.withCredentials=!0,s.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){venraastool.doCookieSetup("venguid",this.responseText,31536e7),o=this.responseText;var n="https://"+venstrob.strserver+venstrob.struuidapi+"?id="+top.location.host+"&typ=s&pt=a",s=venraastool.xhr();s.open("GET",n,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8"),s.withCredentials=!0,s.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){venraastool.doCookieSetup("vensession",this.responseText,18e5),r=this.responseText;var n="https://"+venstrob.strDhermesHost+venstrob.strDHermesApi;t.ven_guid=o,t.ven_session=r;var s=venraastool.xhr();s.open("POST",n,!0),s.setRequestHeader("Content-type","application/json; charset=UTF-8"),s.withCredentials=!0,s.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&(venraastool.saveLocalStorage(t,this.responseText),e(this.responseText,t))}catch(t){console.log(t.message)}},s.timeout=2e3,s.ontimeout=function(o){var n=venraastool.getLocalStorage(t);n?console.log("venraas recomd timeout! response the last result"):(n={},console.log("venraas recomd timeout! none of the last result")),e(n,t)};var a=JSON.stringify(t);s.send(a)}}catch(t){}},s.send()}}catch(t){}},void s.send()}var r=venraastool.getcookie("vensession");if(""==r){console.log("debug in vensession is not exist");var a="https://"+venstrob.strserver+venstrob.struuidapi+"?id="+top.location.host+"&typ=s&pt=a",i=venraastool.xhr();return i.open("GET",a,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8"),i.withCredentials=!0,i.onreadystatechange=function(){try{if(4==this.readyState&&200==this.status){venraastool.doCookieSetup("vensession",this.responseText,18e5),r=this.responseText;var n="https://"+venstrob.strDhermesHost+venstrob.strDHermesApi;t.ven_guid=o,t.ven_session=r;var s=venraastool.xhr();s.open("POST",n,!0),s.setRequestHeader("Content-type","application/json; charset=UTF-8"),s.withCredentials=!0,s.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&(venraastool.saveLocalStorage(t,this.responseText),e(this.responseText,t))}catch(t){console.log(t.message)}},s.timeout=2e3,s.ontimeout=function(o){var n=venraastool.getLocalStorage(t);n?console.log("venraas recomd timeout! response the last result"):(n={},console.log("venraas recomd timeout! none of the last result")),e(n,t)};var a=JSON.stringify(t);s.send(a)}}catch(t){}},void i.send()}console.log("debug in venguid & vensession are exist");var c="https://"+venstrob.strDhermesHost+venstrob.strDHermesApi;t.ven_guid=o,t.ven_session=r;var l=venraastool.xhr();l.open("POST",c,!0),l.setRequestHeader("Content-type","application/json; charset=UTF-8"),l.withCredentials=!0,l.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&(venraastool.saveLocalStorage(t,this.responseText),e(this.responseText,t))}catch(t){console.log(t.message)}},l.timeout=2e3,l.ontimeout=function(o){lastRespText?console.log("venraas recomd timeout! response the last result"):(lastRespText={},console.log("venraas recomd timeout! none of the last result")),e(lastRespText,t)};var v=JSON.stringify(t);l.send(v)},goods_keywords:function(t,e){var o=venraastool.xhr();o.onreadystatechange=function(){try{4==this.readyState&&200==this.status&&e(this.responseText)}catch(t){console.log(t.message)}},o.open("POST","https://"+venstrob.strCupidHost+venstrob.strCupidKeywordApi,!0),o.setRequestHeader("Content-type","application/json; charset=UTF-8"),o.withCredentials=!0;var n=JSON.stringify(t);o.send(n)},get_paramValFromURL:function(t,e){var o=e.split("?",2);if(2==o.length)for(var n=o[1].split("&"),s=0;s<n.length;++s){var r=n[s].split("=",2);if(2==r.length&&t==r[0])return decodeURIComponent(r[1].replace(/\+/g," "))}return null}},vencontrob={createcontr:function(t,e){this.creadata(t),this.setpdata(t,venstrob.stract,t),this.addcontr(t,e)},addcontr:function(t,e){for(var o in e)this.setpdata(t,o,e[o])},addrecitemcontr:function(t,e){venraastool.isarray(this.pdata[t].now_rec)||(this.pdata[t].now_rec=new Array);var o=this.pdata[t].now_rec.length;this.pdata[t].now_rec[o]=e},addtritemcontr:function(t,e){venraastool.isarray(this.pdata[t].trans_i.ilist)||(this.pdata[t].trans_i.ilist=new Array);var o=this.pdata[t].trans_i.ilist.length;this.pdata[t].trans_i.ilist[o]=e},sendcontr:function(t){t==venstrob.strall?this.apirequest(venstrob.strnull):this.apirequest(t)},autoretrieve:function(t){this.setpdata(t,"para",location.search),this.setpdata(t,"uri",location.pathname),this.setpdata(t,"client_host",venstrob.strdn),this.setpdata(t,"token",venstrob.strtoken),this.setpdata(t,"tophost",top.location.host),this.setpdata(t,"referrer",document.referrer);try{this.setpdata(t,"client_tzo",(new Date).getTimezoneOffset()),this.setpdata(t,"client_utc",(new Date).getTime())}catch(t){}this.setpdata(t,"ven_guid",venraastool.getcookie("venguid")),this.setpdata(t,"ven_session",venraastool.getcookie("vensession")),this.setpdata(t,"ver",venstrob.v);var e=this.getpdata(t,"from_rec");e&&"null"!=e||(e=venraastool.get_paramValFromURL("from_rec",location.href))&&this.setpdata(t,"from_rec",e)},pdata:new Object,creadata:function(t){this.pdata[t]={}},getpdata:function(t,e){return this.pdata[t]?this.pdata[t][e]:void 0},setpdata:function(t,e,o){void 0!==this.pdata[t]?this.pdata[t][e]=o:(this.pdata[t]={},this.pdata[t][e]=o)},delpdata:function(t){t==venstrob.strnull?this.pdata={}:this.pdata[t]={}},apirequest:function(t){var e,o=venraastool.urlparamfactory(t,this.pdata);if(""!==o)try{window.XDomainRequest&&(navigator.userAgent.indexOf("MSIE 8.0")>0||navigator.userAgent.indexOf("MSIE 9.0")>0)?venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.strlogapi+"?"+o):navigator.userAgent.indexOf("MSIE 7.0")>0||navigator.userAgent.indexOf("MSIE 6.0")>0?venraastool.ven_jsonp("https://"+venstrob.strserver+venstrob.strlogapi+"?"+o):((e=venraastool.xhr()).open("POST","https://"+venstrob.strserver+venstrob.strlogapi,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8"),e.withCredentials=!0,e.onreadystatechange=function(){try{4==e.readyState&&e.status}catch(t){}},e.send(o))}catch(t){}},actioncontroller:function(t){var e=venfloctl[t].contr,o=venfloctl[t].venact,n=venfloctl[t].objv;switch(e){case venstrob.strcrt:var s=!0;0==n.autosend&&(s=!1),vencontrob.createcontr(o,n),vencontrob.autoretrieve(o),1==s&&vencontrob.sendcontr(o);break;case venstrob.stradd:vencontrob.addcontr(o,n);break;case venstrob.strsnd:vencontrob.sendcontr(o);break;case venstrob.strrec:vencontrob.addrecitemcontr(o,n)}venfloctl[t].status=!0},vencookiecontr:function(t,e){"g"==t?venraastool.doCookieSetup("venguid",e,31536e7):"s"==t&&venraastool.doCookieSetup("vensession",e,18e5)}};function vengujsonpcallbk(t,e){try{vencontrob.vencookiecontr(t,e),"s"==t?vencontrob.actioncontroller(venstrob.venfloctl_processing):venfloctl[venstrob.venfloctl_processing].status=!0}catch(t){}}var venraas={init:function(t){try{if(void 0!==t&&void 0!==t.domainName&&(venstrob.strdn=t.domainName),void 0!==t&&void 0!==t.token&&(venstrob.strtoken=t.token),null===document.getElementById("venraasfr")){var e=document.createElement("iframe");e.setAttribute("id","venraasfr"),e.style.display="none",e.style.width="1px",e.style.height="1px",e.style.border="0px",e.style.padding="0px",e.style.margin="0px",e.src="https://"+venstrob.strserver+venstrob.struuidapi,void 0===t||void 0===t.tagID?document.body.appendChild(e):null!==document.getElementById(t.tagID)?document.getElementById(t.tagID).appendChild(e):console.log("[Error] venraas document.getElementById("+t.tagID+") is not exist!")}if(""==venraastool.getcookie("venguid")&&void 0!==venfloctl){var o=venraastool.object_size(venfloctl);venfloctl[o]={},venfloctl[o].status=!1,venfloctl[o].contr="",venfloctl[o].venact="",venfloctl[o].objv="",venfloctl[o].type=venstrob.strtypeGuid,venfloctl[o].retry=0,this.ven_cps(o)}}catch(t){}},tracking:function(t,e){try{if(void 0===e&&(e={}),0==venraastool.dect_type(t,e))return;var o="",n="";if(t.indexOf("|")>-1?(cmdar=t.split("|"),o=cmdar[0],n=cmdar[1]):(o=venstrob.strall,n=t),void 0!==venfloctl){var s=venraastool.object_size(venfloctl);venfloctl[s]={},venfloctl[s].status=!1,venfloctl[s].contr=n,venfloctl[s].venact=o,venfloctl[s].objv=e,venfloctl[s].type=venstrob.strtypeTracking,venfloctl[s].retry=0,this.ven_cps(s)}}catch(t){}},ven_tracking:function(t){""==venraastool.getcookie("vensession")?venraastool.getvenuuid("s",t):(venraastool.doCookieSetup("vensession",venraastool.getcookie("vensession"),18e5),vencontrob.actioncontroller(t))},ven_cps:function(t){try{if(0==t||venfloctl[t-1].status)switch(venfloctl[t].type){case venstrob.strtypeTracking:venraas.ven_tracking(t);break;case venstrob.strtypeEctrans:venraas.ven_ecTransaction(t);break;case venstrob.strtypeGuid:venraastool.getvenuuid("g",t);break;case venstrob.strtypeSession:venraastool.getvenuuid("s",t);break;case venstrob.strtypeRecomd:venraastool.getrecomd(t)}else venfloctl[t].retry<3&&(venfloctl[t].retry++,setTimeout("venraas.ven_cps("+t+")",100))}catch(t){}},ecTransaction:function(t,e){try{if(void 0===e&&(e={}),0==venraastool.dect_type(t,e))return;var o="",n="";if(t.indexOf("|")>-1&&(cmdar=t.split("|"),o=cmdar[0],n=cmdar[1]),void 0!==venfloctl){var s=venraastool.object_size(venfloctl);venfloctl[s]={},venfloctl[s].status=!1,venfloctl[s].contr=n,venfloctl[s].venact=o,venfloctl[s].objv=e,venfloctl[s].type=venstrob.strtypeEctrans,venfloctl[s].retry=0,this.ven_cps(s)}}catch(t){}},ven_ecTransaction:function(t){var e=venfloctl[t].contr,o=venfloctl[t].objv,n=venfloctl[t].venact;switch(e){case venstrob.stradd:o.ilist={};var s=new Object;s.trans_i=o,vencontrob.addcontr(n,s);break;case venstrob.stradi:vencontrob.addtritemcontr(n,o);break;default:console.log(venstrob.strwarn+":input exception. c3")}venfloctl[t].status=!0}};
